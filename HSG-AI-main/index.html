<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HSG AI - مساعد ذكاء اصطناعي عربي متطور | مساعد افتراضي ذكي</title>
    <meta name="description" content="HSG AI - مساعد ذكاء اصطناعي عربي متطور يساعدك في الإجابة على الأسئلة، توليد المحتوى، حل المشكلات البرمجية، الترجمة، الكتابة الإبداعية والمزيد. مساعد ذكي مجاني للغة العربية.">
    <meta name="keywords" content="مساعد ذكي, ذكاء اصطناعي عربي, مساعد افتراضي, مساعد برمجي, حلول ذكية, chatbot عربي, AI assistant, HSG AI, مساعد عربي, مساعد ذكي مجاني, مساعد برمجي عربي, مساعد كتابة عربي, مساعد ترجمة, مساعد حل مشاكل, مساعد ذكاء اصطناعي مجاني">
    <meta name="author" content="HSG AI Team">
    <meta name="robots" content="index, follow">
    <meta name="language" content="Arabic">
    <meta name="revisit-after" content="7 days">
    <meta name="generator" content="HSG AI">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://hsg-ashy.vercel.app/">
    <meta property="og:title" content="HSG AI - مساعد ذكاء اصطناعي عربي متطور">
    <meta property="og:description" content="مساعد ذكاء اصطناعي عربي متطور يساعدك في الإجابة على الأسئلة، توليد المحتوى، حل المشكلات البرمجية والمزيد.">
    <meta property="og:image" content="https://i.postimg.cc/bJ4MsXmj/1000023429.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://hsg-ashy.vercel.app/">
    <meta property="twitter:title" content="HSG AI - مساعد ذكاء اصطناعي عربي متطور">
    <meta property="twitter:description" content="مساعد ذكاء اصطناعي عربي متطور يساعدك في الإجابة على الأسئلة، توليد المحتوى، حل المشكلات البرمجية والمزيد.">
    <meta property="twitter:image" content="https://i.postimg.cc/bJ4MsXmj/1000023429.png">
    
    <!-- Favicon -->
    <link rel="icon" href="https://i.postimg.cc/bJ4MsXmj/1000023429.png" type="image/png">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/1036/1036766.png">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://hsg-ashy.vercel.app/">
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        :root {
            /* Dark theme (default) */
            --primary: #6e00ff;
            --primary-light: #8d3aff;
            --secondary: #ff00e4;
            --secondary-light: #ff4dec;
            --dark: #0a041a;
            --dark-light: #1a0c3a;
            --light: #f0f0ff;
            --light-dark: #d0d0e0;
            --accent: #00f7ff;
            --accent-dark: #00c4cc;
            --error: #ff3860;
            --success: #00d1b2;
            --warning: #ffb347;
            --bg: var(--dark);
            --text: var(--light);
            --chat-bg: rgba(20, 10, 40, 0.95);
            --code-bg: #1e1e3f;
            --code-border: #3a3a5a;
            --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --message-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --font-size: 1em;
        }

        :root[data-theme="light"] {
            --bg: #ffffff;
            --bg-dark: #f8f9fa;
            --text: #2c3e50;
            --text-light: #34495e;
            --chat-bg: rgba(255, 255, 255, 0.98);
            --primary: #4a6ef5;
            --primary-light: #6a8eff;
            --secondary: #6e47ff;
            --secondary-light: #8e67ff;
            --accent: #8c4dff;
            --accent-dark: #6c2dff;
            --message-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            --card-border: rgba(0, 0, 0, 0.1);
            --input-bg: #ffffff;
            --button-hover: #f0f0f0;
            --code-bg: #f8f9fa;
            --code-border: #e9ecef;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --message-bg: #f8f9fa;
            --user-message-bg: linear-gradient(135deg, #4a6ef5, #6e47ff);
            --bot-message-bg: #ffffff;
            --bot-message-border: 1px solid rgba(0, 0, 0, 0.1);
            --settings-bg: #ffffff;
            --settings-border: 1px solid rgba(0, 0, 0, 0.1);
            --settings-hover: #f8f9fa;
            --emoji-bg: #ffffff;
            --emoji-hover: #f8f9fa;
            --notification-bg: #4a6ef5;
            --notification-text: #ffffff;
            --icon-color: #4a6ef5;
            --icon-hover: #6e47ff;
            --header-bg: linear-gradient(45deg, #4a6ef5, #6e47ff);
            --header-text: #ffffff;
            --header-icon: #ffffff;
            --logo-gradient: linear-gradient(45deg, #4a6ef5, #6e47ff);
            --logo-text: #ffffff;
            --logo-subtitle: rgba(255, 255, 255, 0.9);
        }

        :root[data-theme="light"] .message {
            background: var(--message-bg);
            border: var(--bot-message-border);
            box-shadow: var(--message-shadow);
        }

        :root[data-theme="light"] .user-message {
            background: var(--user-message-bg);
            color: #ffffff;
            border: none;
        }

        :root[data-theme="light"] .bot-message {
            background: var(--bot-message-bg);
            border: var(--bot-message-border);
        }

        :root[data-theme="light"] .settings-panel {
            background: var(--settings-bg);
            border-left: var(--settings-border);
        }

        :root[data-theme="light"] .settings-section {
            background: var(--settings-bg);
            border: var(--settings-border);
        }

        :root[data-theme="light"] .settings-section:hover {
            background: var(--settings-hover);
        }

        :root[data-theme="light"] .emoji-picker {
            background: var(--emoji-bg);
            border: var(--settings-border);
        }

        :root[data-theme="light"] .emoji-item:hover {
            background: var(--emoji-hover);
        }

        :root[data-theme="light"] .notification {
            background: var(--notification-bg);
            color: var(--notification-text);
        }

        :root[data-theme="light"] .code-block {
            background: var(--code-bg);
            border: var(--code-border);
        }

        :root[data-theme="light"] .code-header {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: #ffffff;
        }

        :root[data-theme="light"] .code-content {
            color: var(--text);
            background: var(--code-bg);
        }

        :root[data-theme="light"] .chat-header {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: #ffffff;
        }

        :root[data-theme="light"] .action-btn {
            background: rgba(74, 110, 245, 0.1);
            color: var(--primary);
        }

        :root[data-theme="light"] .action-btn:hover {
            background: rgba(74, 110, 245, 0.2);
        }

        :root[data-theme="light"] .website-link-btn {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: #ffffff;
            box-shadow: 0 4px 15px rgba(74, 110, 245, 0.3);
        }

        :root[data-theme="light"] .website-link-btn:hover {
            box-shadow: 0 6px 20px rgba(74, 110, 245, 0.4);
        }

        :root[data-theme="light"] .settings-info {
            background: linear-gradient(135deg, rgba(74, 110, 245, 0.1), rgba(110, 71, 255, 0.1));
            border: 1px solid rgba(74, 110, 245, 0.2);
        }

        :root[data-theme="light"] .settings-title {
            color: var(--primary);
        }

        :root[data-theme="light"] .settings-section h4 {
            color: var(--primary);
        }

        :root[data-theme="light"] .settings-section h4 i {
            color: var(--secondary);
        }

        :root[data-theme="light"] .user-info {
            color: var(--text);
        }

        :root[data-theme="light"] .message-time {
            color: rgba(44, 62, 80, 0.7);
        }

        :root[data-theme="light"] .message-actions .action-btn {
            background: rgba(74, 110, 245, 0.1);
            color: var(--primary);
        }

        :root[data-theme="light"] .message-actions .action-btn:hover {
            background: rgba(74, 110, 245, 0.2);
        }

        /* Font size variations */
        :root[data-font-size="small"] {
            --font-size: 0.85em;
        }
        :root[data-font-size="medium"] {
            --font-size: 1em;
        }
        :root[data-font-size="large"] {
            --font-size: 1.15em;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(110, 0, 255, 0.15) 0%, transparent 30%),
                radial-gradient(circle at 80% 70%, rgba(255, 0, 228, 0.15) 0%, transparent 30%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-x: hidden;
            transition: var(--transition);
            touch-action: manipulation;
            font-size: var(--font-size);
        }

        .logo-container {
            position: relative;
            z-index: 100;
            background: linear-gradient(90deg, rgba(10, 4, 26, 0.9), rgba(20, 10, 40, 0.9));
            backdrop-filter: blur(10px);
            padding: 15px 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo {
            text-align: center;
            font-size: 2.8em;
            font-weight: 800;
            background: linear-gradient(45deg, #6e00ff, #00f7ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: glow 3s ease-in-out infinite;
            text-shadow: 0 0 15px rgba(110, 0, 255, 0.4);
            letter-spacing: 2px;
            padding: 0 20px;
        }

        .logo-subtitle {
            font-size: 0.5em;
            margin-top: -10px;
            color: var(--accent);
            font-weight: 500;
            letter-spacing: 1px;
        }

        @keyframes glow {
            0%, 100% { 
                filter: drop-shadow(0 0 20px rgba(0, 247, 255, 0.6)); 
                transform: scale(1);
            }
            50% { 
                filter: drop-shadow(0 0 25px rgba(110, 0, 255, 0.8));
                transform: scale(1.02);
            }
        }

        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 10px;
            max-width: 1200px;
            margin: 0 auto;
            height: calc(100vh - 100px);
            position: relative;
            z-index: 5;
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--chat-bg);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            height: 100%;
            position: relative;
        }

        .chat-header {
            padding: 12px 15px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 2;
        }

        .chat-header h3 {
            font-size: 1em;
            font-weight: 700;
            color: var(--light);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .chat-header-actions {
            display: flex;
            gap: 8px;
        }

        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) transparent;
            position: relative;
            z-index: 1;
            -webkit-overflow-scrolling: touch;
        }

        .chat-messages::-webkit-scrollbar {
            width: 5px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background-color: var(--primary);
            border-radius: 4px;
        }

        .message {
            padding: 12px 15px;
            border-radius: 15px;
            position: relative;
            max-width: 95%;
            animation: messageFloat 0.5s ease-out forwards;
            opacity: 0;
            transform-origin: center;
            box-shadow: var(--message-shadow);
            font-size: 1em;
            line-height: 1.6;
            transition: var(--transition);
            word-break: break-word;
        }

        @keyframes messageFloat {
            from { 
                opacity: 0;
                transform: translateY(10px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-message {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-right: 3px solid var(--primary-light);
            margin-left: auto;
            border-top-right-radius: 5px;
            color: white;
        }

        .bot-message {
            background: var(--bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-right: auto;
            border-top-left-radius: 5px;
        }

        :root[data-theme="light"] .bot-message {
            background: var(--input-bg);
            border: 1px solid var(--card-border);
            color: var(--text);
        }

        .typing-indicator {
            padding: 10px 12px;
            display: none;
            align-items: center;
            gap: 6px;
            margin-right: auto;
            background: rgba(0, 247, 255, 0.1);
            border-radius: 12px;
            width: fit-content;
            border-top-left-radius: 5px;
            margin-bottom: 8px;
        }

        .typing-text {
            font-size: 0.85em;
            color: var(--accent);
        }

        .typing-dot {
            display: inline-block;
            width: 6px;
            height: 6px;
            margin: 0 2px;
            background: var(--accent);
            border-radius: 50%;
            animation: typingBounce 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingBounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-4px); }
        }

        .chat-input {
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 10px;
            position: relative;
            z-index: 2;
        }

        #user-input {
            flex: 1;
            padding: 12px 15px;
            border: none;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
            font-size: 1em;
            transition: var(--transition);
            min-height: 45px;
            max-height: 120px;
            resize: none;
            line-height: 1.5;
        }

        #user-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 2px rgba(110, 0, 255, 0.3);
        }

        .input-actions {
            display: flex;
            gap: 6px;
        }

        .chat-input button {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            padding: 0;
            flex-shrink: 0;
        }

        #send-button {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
        }

        #send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(110, 0, 255, 0.4);
        }

        #send-button:active {
            transform: translateY(0);
        }

        #send-button svg {
            width: 20px;
            height: 20px;
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        /* Space Elements */
        .space-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
            background: radial-gradient(circle at center, #0a041a 0%, #1a0c3a 100%);
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle var(--duration) infinite ease-in-out;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.8),
                       0 0 15px rgba(110, 0, 255, 0.4);
        }

        @keyframes twinkle {
            0%, 100% { 
                opacity: 0.3;
                transform: scale(1);
            }
            50% { 
                opacity: 1;
                transform: scale(1.2);
            }
        }

        .meteor {
            position: absolute;
            width: 150px;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), transparent);
            animation: meteor var(--duration) linear infinite;
            opacity: 0;
            transform: rotate(-45deg);
            box-shadow: 0 0 10px var(--primary);
        }

        @keyframes meteor {
            0% {
                transform: translateX(-100px) translateY(-100px) rotate(-45deg);
                opacity: 1;
            }
            70%, 100% {
                transform: translateX(200px) translateY(200px) rotate(-45deg);
                opacity: 0;
            }
        }

        .planet {
            position: absolute;
            border-radius: 50%;
            filter: blur(1px);
            opacity: 0.7;
            z-index: -1;
            box-shadow: 0 0 30px rgba(110, 0, 255, 0.3);
        }

        .moon {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle, #f5f5f5 0%, #cccccc 70%);
            box-shadow: 0 0 40px rgba(245, 245, 245, 0.6),
                       0 0 60px rgba(110, 0, 255, 0.3);
            z-index: -1;
            animation: moonGlow 8s infinite ease-in-out;
        }

        @keyframes moonGlow {
            0%, 100% { 
                box-shadow: 0 0 40px rgba(245, 245, 245, 0.6),
                           0 0 60px rgba(110, 0, 255, 0.3);
            }
            50% { 
                box-shadow: 0 0 50px rgba(245, 245, 245, 0.8),
                           0 0 80px rgba(110, 0, 255, 0.5);
            }
        }

        .satellite {
            position: absolute;
            font-size: 24px;
            animation: orbit 20s linear infinite;
            z-index: -1;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
        }

        @keyframes orbit {
            0% { transform: rotate(0deg) translateX(200px) rotate(0deg); }
            100% { transform: rotate(360deg) translateX(200px) rotate(-360deg); }
        }

        /* Enhanced Fullscreen Mode */
        .chat-container.fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            max-width: none;
            border-radius: 0;
            background: var(--chat-bg);
            backdrop-filter: blur(20px);
            z-index: 1000;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .chat-container.fullscreen .chat-header {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chat-container.fullscreen .chat-messages {
            height: calc(100vh - 140px);
            padding: 20px;
        }

        .chat-container.fullscreen .chat-input {
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Enhanced Icons */
        .action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text);
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85em;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(5px);
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .action-btn i {
            font-size: 1.1em;
            transition: transform 0.3s ease;
        }

        .action-btn:hover i {
            transform: scale(1.2);
        }

        /* Enhanced Controls */
        .controls {
            position: fixed;
            bottom: 90px;
            left: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .control-btn {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            border: none;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .control-btn:hover {
            transform: scale(1.1) translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        .control-btn svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
            transition: transform 0.3s ease;
        }

        .control-btn:hover svg {
            transform: scale(1.2);
        }

        /* Code Block Styling */
        .code-block {
            position: relative;
            background: var(--code-bg);
            border-radius: 12px;
            margin: 15px 0;
            border: 1px solid var(--code-border);
            overflow: hidden;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
            line-height: 1.5;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: var(--transition);
        }

        .code-block:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .code-language {
            font-size: 0.8em;
            color: white;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 3px 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        .copy-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8em;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: var(--transition);
        }

        .copy-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .copy-btn.copied {
            background: var(--success);
            color: white;
            animation: copySuccess 0.3s ease-in-out;
        }

        .code-content {
            padding: 15px;
            overflow-x: auto;
            white-space: pre;
            color: #e0e0e0;
            background: var(--code-bg);
            position: relative;
            counter-reset: line;
            padding-left: 3.5em;
        }

        .code-content::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3em;
            background: rgba(255, 255, 255, 0.05);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        .code-content > span {
            display: block;
            position: relative;
        }

        .code-content > span::before {
            counter-increment: line;
            content: counter(line);
            position: absolute;
            left: -3.5em;
            width: 2.5em;
            text-align: right;
            color: rgba(255, 255, 255, 0.3);
            font-size: 0.9em;
            padding-right: 1em;
        }

        .code-content::-webkit-scrollbar {
            height: 8px;
        }

        .code-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .code-content::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        .code-content::-webkit-scrollbar-thumb:hover {
            background: var(--primary-light);
        }

        @keyframes copySuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Controls */
        .controls {
            position: fixed;
            bottom: 80px;
            left: 12px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.2);
            padding: 8px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .control-btn {
            width: 38px;
            height: 38px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .control-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .control-btn svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }

        /* Ripple Effect */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }

        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        /* Fullscreen mode */
        .chat-container.fullscreen {
            position: fixed;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            width: 95vw;
            height: calc(100vh - 60px);
            max-width: 1400px;
            z-index: 1000;
            border-radius: 12px;
            background: var(--chat-bg);
            backdrop-filter: blur(20px);
        }

        /* Logo in fullscreen mode */
        .chat-container.fullscreen ~ .logo {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 8px 0;
            background: var(--bg);
            backdrop-filter: blur(20px);
            z-index: 1001;
            margin: 0;
            font-size: 1.5em;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        /* Action Buttons */
        .action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text);
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.75em;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: var(--transition);
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Message Actions */
        .message-actions {
            display: flex;
            gap: 6px;
            margin-top: 8px;
            opacity: 0;
            transition: var(--transition);
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        /* Settings Panel */
        .settings-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 320px;
            height: 100%;
            background: var(--chat-bg);
            backdrop-filter: blur(15px);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: -5px 0 20px rgba(0, 0, 0, 0.2);
            transform: translateX(100%);
            transition: var(--transition);
            z-index: 1001;
            padding: 20px;
            overflow-y: auto;
        }

        .settings-panel.open {
            transform: translateX(0);
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .settings-title {
            font-size: 1.3em;
            font-weight: bold;
            color: var(--accent);
        }

        /* Settings Panel Close Button */
        .close-settings {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1.2em;
        }

        .close-settings:hover {
            background: rgba(255, 0, 0, 0.2);
            transform: scale(1.1);
        }

        .close-settings i {
            font-size: 1.4em;
            color: var(--text);
        }

        .settings-section {
            margin-bottom: 25px;
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .settings-section h4 {
            margin-bottom: 15px;
            color: var(--accent);
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .settings-section h4 i {
            font-size: 1em;
        }

        .settings-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 8px 0;
        }

        .settings-option label {
            flex: 1;
            margin-right: 15px;
            font-size: 0.95em;
        }

        /* Switch Toggle - Enhanced Design */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 28px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to right, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.2));
            transition: 0.4s;
            border-radius: 28px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(4px);
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            right: 4px;
            bottom: 2px;
            background: white;
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        input:checked + .slider {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border-color: rgba(255, 255, 255, 0.3);
        }

        input:checked + .slider:before {
            transform: translateX(-32px);
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* ON/OFF Labels */
        .switch-labels {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 6px;
            font-size: 0.7em;
            font-weight: bold;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            pointer-events: none;
            transition: 0.4s;
            direction: ltr;
        }

        .switch-labels span {
            transition: 0.4s;
        }

        .switch-labels span:first-child {
            opacity: 0;
            transform: translateX(10px);
        }

        .switch-labels span:last-child {
            opacity: 1;
            transform: translateX(0);
        }

        input:checked ~ .switch-labels span:first-child {
            opacity: 1;
            transform: translateX(0);
        }

        input:checked ~ .switch-labels span:last-child {
            opacity: 0;
            transform: translateX(-10px);
        }

        /* Hover and focus effects */
        .slider:hover {
            border-color: rgba(255, 255, 255, 0.3);
        }

        .slider:hover:before {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        input:focus + .slider {
            box-shadow: 0 0 0 2px rgba(110, 0, 255, 0.2);
        }

        /* Select Dropdown */
        select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
            font-size: 0.9em;
            transition: var(--transition);
            min-width: 150px;
        }

        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(110, 0, 255, 0.3);
        }

        /* Notification */
        .notification {
            position: fixed;
            bottom: 15px;
            right: 15px;
            padding: 12px 15px;
            background: var(--primary);
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transform: translateY(100px);
            opacity: 0;
            transition: var(--transition);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
            max-width: 280px;
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        .notification i {
            font-size: 1.1em;
        }

        .notification.success {
            background: var(--success);
        }

        .notification.error {
            background: var(--error);
        }

        .notification.warning {
            background: var(--warning);
        }

        /* Message Time */
        .message-time {
            font-size: 0.75em;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 6px;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: var(--transition);
        }

        .message-time i {
            font-size: 0.9em;
            transition: var(--transition);
        }

        .message-time .status-icon {
            margin-right: 4px;
        }

        .message-time .clock-icon {
            color: rgba(255, 255, 255, 0.6);
        }

        .message-time .sent-icon {
            color: #ffffff;
        }

        .message-time .delivered-icon {
            color: #00f7ff;
        }

        .message-time .read-icon {
            color: #4a6ef5;
        }

        :root[data-theme="light"] .message-time {
            color: rgba(0, 0, 0, 0.5);
        }

        :root[data-theme="light"] .message-time .clock-icon {
            color: rgba(0, 0, 0, 0.5);
        }

        :root[data-theme="light"] .message-time .sent-icon {
            color: #333333;
        }

        :root[data-theme="light"] .message-time .delivered-icon {
            color: #4a6ef5;
        }

        :root[data-theme="light"] .message-time .read-icon {
            color: #6e47ff;
        }

        /* Animation for new messages */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.new {
            animation: slideIn 0.3s ease-out forwards;
        }

        /* Loading animation */
        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .loading {
            animation: pulse 1.5s infinite ease-in-out;
        }

        /* Markdown Styles */
        .message strong {
            font-weight: bold;
        }

        .message em {
            font-style: italic;
        }

        .message ul, .message ol {
            padding-right: 15px;
            margin: 8px 0;
        }

        .message li {
            margin-bottom: 4px;
        }

        .message a {
            color: var(--accent);
            text-decoration: none;
        }

        .message a:hover {
            text-decoration: underline;
        }

        .message blockquote {
            border-right: 2px solid var(--primary);
            padding-right: 12px;
            margin: 8px 0;
            color: var(--text);
            opacity: 0.8;
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 100px;
            background-color: var(--dark);
            color: var(--light);
            text-align: center;
            border-radius: 6px;
            padding: 4px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            right: 50%;
            transform: translateX(50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.75em;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Welcome Modal */
        .welcome-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }

        .welcome-modal.show {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background: var(--chat-bg);
            border-radius: 15px;
            padding: 20px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            transform: translateY(20px);
            transition: var(--transition);
        }

        .welcome-modal.show .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 15px;
        }

        .modal-header h2 {
            font-size: 1.5em;
            margin-bottom: 8px;
            background: linear-gradient(45deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .modal-body {
            margin-bottom: 20px;
            font-size: 0.9em;
        }

        .modal-footer {
            display: flex;
            justify-content: center;
        }

        .modal-btn {
            padding: 8px 15px;
            border-radius: 8px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            cursor: pointer;
            font-size: 0.95em;
            transition: var(--transition);
        }

        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(110, 0, 255, 0.4);
        }

        /* Suggestions */
        .suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .suggestion-btn {
            padding: 6px 10px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text);
            cursor: pointer;
            font-size: 0.75em;
            transition: var(--transition);
        }

        .suggestion-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Emoji Picker */
        .emoji-picker {
            position: fixed;
            bottom: 80px;
            right: 15px;
            width: 300px;
            max-height: 350px;
            background: var(--chat-bg);
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            z-index: 1002;
            display: none;
            flex-direction: column;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
            transform: translateY(20px);
            opacity: 0;
            transition: var(--transition);
        }

        .emoji-picker.show {
            display: flex;
            transform: translateY(0);
            opacity: 1;
        }

        .emoji-categories {
            display: flex;
            overflow-x: auto;
            padding: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .emoji-category {
            padding: 6px 10px;
            border: none;
            background: none;
            color: var(--text);
            cursor: pointer;
            font-size: 0.8em;
            border-radius: 6px;
            transition: var(--transition);
            white-space: nowrap;
        }

        .emoji-category.active {
            background: rgba(255, 255, 255, 0.2);
        }

        .emoji-category:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 5px;
            padding: 10px;
            overflow-y: auto;
            flex: 1;
        }

        .emoji-item {
            font-size: 1.5em;
            text-align: center;
            padding: 5px;
            cursor: pointer;
            border-radius: 6px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            aspect-ratio: 1/1;
        }

        .emoji-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.2);
        }

        /* Mobile-specific optimizations */
        @media (max-width: 480px) {
            .logo-container {
                padding: 10px 0;
            }
            
            .logo {
                font-size: 1.8em;
            }

            .container {
                padding: 8px;
                height: calc(100vh - 80px);
            }

            .chat-header {
                padding: 10px;
            }

            .chat-header h3 {
                font-size: 0.9em;
            }

            .chat-messages {
                padding: 10px;
                gap: 12px;
            }

            .message {
                max-width: 98%;
                font-size: 0.9em;
                padding: 10px 12px;
            }

            .chat-input {
                padding: 8px;
            }

            #user-input {
                padding: 10px;
                font-size: 0.9em;
                min-height: 40px;
            }

            .chat-input button {
                width: 40px;
                height: 40px;
            }

            .chat-input button svg {
                width: 18px;
                height: 18px;
            }

            .controls {
                bottom: 70px;
                left: 8px;
                gap: 8px;
                padding: 6px;
            }

            .control-btn {
                width: 34px;
                height: 34px;
            }

            .control-btn svg {
                width: 16px;
                height: 16px;
            }

            .settings-panel {
                width: 90%;
                padding: 12px;
            }

            .notification {
                max-width: 90%;
                right: 5%;
                bottom: 10px;
            }

            .emoji-picker {
                width: 90%;
                right: 5%;
                bottom: 70px;
            }

            .emoji-grid {
                grid-template-columns: repeat(6, 1fr);
            }
        }

        @media (max-height: 500px) {
            .logo-container {
                padding: 8px 0;
            }
            
            .logo {
                font-size: 1.5em;
            }

            .container {
                height: calc(100vh - 60px);
            }
        }

        .settings-info {
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .user-info {
            color: var(--text);
            font-size: 0.9em;
            margin: 0;
        }
        
        .danger-btn {
            color: #ff3860 !important;
        }
        
        .danger-btn:hover {
            background: rgba(255, 0, 0, 0.2) !important;
        }

        .settings-danger-btn {
            width: 100%;
            padding: 12px;
            background: rgba(255, 56, 96, 0.1);
            border: 1px solid rgba(255, 56, 96, 0.2);
            border-radius: 8px;
            color: #ff3860;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: var(--transition);
            font-size: 0.95em;
            margin-top: 10px;
        }

        .settings-danger-btn:hover {
            background: rgba(255, 56, 96, 0.2);
            transform: translateY(-2px);
        }

        .settings-danger-btn i {
            font-size: 1.1em;
        }

        /* Add CSS for markdown formatting */
        .message code {
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 4px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .message mark {
            background: var(--accent);
            color: var(--dark);
            padding: 2px 4px;
            border-radius: 4px;
        }
        
        .message del {
            text-decoration: line-through;
            opacity: 0.7;
        }
        
        .message h1, .message h2, .message h3, 
        .message h4, .message h5, .message h6 {
            margin: 10px 0;
            color: var(--accent);
        }
        
        .message h1 { font-size: 1.8em; }
        .message h2 { font-size: 1.6em; }
        .message h3 { font-size: 1.4em; }
        .message h4 { font-size: 1.2em; }
        .message h5 { font-size: 1.1em; }
        .message h6 { font-size: 1em; }

        /* Add CSS for the view code button */
        .view-code-btn {
            display: block;
            width: 100%;
            padding: 8px;
            margin-top: 10px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            transition: var(--transition);
        }

        .view-code-btn:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
        }

        .view-code-btn i {
            margin-left: 5px;
        }

        /* Code Preview Modal */
        .code-preview-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .code-preview-modal.show {
            display: flex;
        }

        .code-preview-content {
            background: var(--chat-bg);
            border-radius: 15px;
            width: 90%;
            max-width: 1200px;
            height: 80vh;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .code-preview-header {
            padding: 15px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .code-preview-title {
            color: white;
            font-size: 1.1em;
            font-weight: bold;
        }

        .close-preview {
            background: none;
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px;
            transition: var(--transition);
        }

        .close-preview:hover {
            transform: scale(1.1);
        }

        .code-preview-frame {
            width: 100%;
            height: calc(100% - 60px);
            border: none;
            background: white;
        }

        /* Add CSS for message text */
        .message-text {
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .message-text:last-child {
            margin-bottom: 0;
        }
        
        .message-text code {
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 4px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .message-text strong {
            font-weight: bold;
        }
        
        .message-text em {
            font-style: italic;
        }
        
        .message-text del {
            text-decoration: line-through;
            opacity: 0.7;
        }
        
        .message-text mark {
            background: var(--accent);
            color: var(--dark);
            padding: 2px 4px;
            border-radius: 4px;
        }
        
        .message-text h1, .message-text h2, .message-text h3,
        .message-text h4, .message-text h5, .message-text h6 {
            margin: 10px 0;
            color: var(--accent);
        }
        
        .message-text h1 { font-size: 1.8em; }
        .message-text h2 { font-size: 1.6em; }
        .message-text h3 { font-size: 1.4em; }
        .message-text h4 { font-size: 1.2em; }
        .message-text h5 { font-size: 1.1em; }
        .message-text h6 { font-size: 1em; }

        /* Add new styles for the website link button */
        .website-link-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            margin: 10px 0;
            box-shadow: 0 4px 15px rgba(110, 0, 255, 0.3);
        }

        .website-link-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(110, 0, 255, 0.4);
        }

        .website-link-btn i {
            font-size: 1.1em;
            transition: transform 0.3s ease;
        }

        .website-link-btn:hover i {
            transform: translateX(3px);
        }

        /* Update settings info styles */
        .settings-info {
            background: linear-gradient(135deg, rgba(110, 0, 255, 0.1), rgba(255, 0, 228, 0.1));
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
        }

        .settings-info .user-info {
            color: var(--text);
            font-size: 0.95em;
            line-height: 1.6;
        }

        .settings-info .user-info p {
            margin-bottom: 12px;
        }

        .settings-info .user-info p:last-child {
            margin-bottom: 0;
        }

        /* Update message styles */
        .message {
            background: linear-gradient(135deg, rgba(110, 0, 255, 0.1), rgba(255, 0, 228, 0.1));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        :root[data-theme="light"] .logo-container {
            background: var(--header-bg);
            box-shadow: 0 4px 20px rgba(74, 110, 245, 0.2);
        }

        :root[data-theme="light"] .logo {
            background: var(--logo-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 15px rgba(74, 110, 245, 0.4);
        }

        :root[data-theme="light"] .logo-subtitle {
            color: var(--logo-subtitle);
        }

        :root[data-theme="light"] .chat-header {
            background: var(--header-bg);
        }

        :root[data-theme="light"] .chat-header h3 {
            color: var(--header-text);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        :root[data-theme="light"] .chat-header-actions .action-btn {
            background: rgba(255, 255, 255, 0.2);
            color: var(--header-icon);
        }

        :root[data-theme="light"] .chat-header-actions .action-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        :root[data-theme="light"] .action-btn i {
            color: var(--icon-color);
        }

        :root[data-theme="light"] .action-btn:hover i {
            color: var(--icon-hover);
        }

        :root[data-theme="light"] .control-btn {
            background: var(--header-bg);
            color: var(--header-icon);
            box-shadow: 0 4px 12px rgba(74, 110, 245, 0.3);
        }

        :root[data-theme="light"] .control-btn:hover {
            background: linear-gradient(45deg, #6e47ff, #4a6ef5);
            box-shadow: 0 6px 15px rgba(74, 110, 245, 0.4);
        }

        :root[data-theme="light"] .settings-btn i,
        :root[data-theme="light"] .help-btn i,
        :root[data-theme="light"] .clear-chat i,
        :root[data-theme="light"] .emoji-btn i {
            color: var(--icon-color);
        }

        :root[data-theme="light"] .settings-btn:hover i,
        :root[data-theme="light"] .help-btn:hover i,
        :root[data-theme="light"] .clear-chat:hover i,
        :root[data-theme="light"] .emoji-btn:hover i {
            color: var(--icon-hover);
        }

        :root[data-theme="light"] .close-settings i {
            color: var(--icon-color);
        }

        :root[data-theme="light"] .close-settings:hover i {
            color: #ff3860;
        }

        :root[data-theme="light"] .settings-section h4 i {
            color: var(--icon-color);
            margin-left: 8px;
        }

        :root[data-theme="light"] .settings-danger-btn i {
            color: #ff3860;
        }

        :root[data-theme="light"] .settings-danger-btn:hover i {
            color: #ff1443;
        }

        :root[data-theme="light"] .message-actions .action-btn i {
            color: var(--icon-color);
        }

        :root[data-theme="light"] .message-actions .action-btn:hover i {
            color: var(--icon-hover);
        }

        :root[data-theme="light"] .like-btn:hover i {
            color: #00d1b2;
        }

        :root[data-theme="light"] .dislike-btn:hover i {
            color: #ff3860;
        }

        :root[data-theme="light"] .copy-btn:hover i {
            color: var(--icon-hover);
        }

        :root[data-theme="light"] .website-link-btn i {
            color: #ffffff;
        }

        :root[data-theme="light"] .notification i {
            color: #ffffff;
        }
    </style>
</head>
<body>
    <script src="scripts/auth-check.js"></script>
    <div class="logo-container">
        <div class="logo">HSG AI<div class="logo-subtitle">مساعد ذكي متطور</div></div>
    </div>
    <div class="space-bg" id="space-bg"></div>
    
    <div class="container">
        <div class="chat-container">
            <div class="chat-header">
                <h3>مساعدك الذكي الشخصي</h3>
                <div class="chat-header-actions">
                    <button class="action-btn" id="emoji-btn" title="إضافة إيموجي">
                        <i class="far fa-smile"></i>
                    </button>
                    <button class="action-btn" id="clear-chat" title="مسح المحادثة">
                        <i class="fas fa-trash"></i>
                    </button>
                    <button class="action-btn" id="settings-btn" title="الإعدادات">
                        <i class="fas fa-cog"></i>
                    </button>
                    <button class="action-btn" id="help-btn" title="المساعدة">
                        <i class="fas fa-question-circle"></i>
                    </button>
                </div>
            </div>
            <div class="chat-messages" id="chat-messages"></div>
            <div class="typing-indicator" id="typing-indicator">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <span class="typing-text">يكتب...</span>
            </div>            <div class="chat-input">
                <textarea id="user-input" placeholder="اكتب رسالتك هنا..." dir="rtl" rows="1"></textarea>
                <div class="input-actions">
                    <input type="file" id="image-input" accept="image/*" style="display: none;">
                    <button id="image-button" class="action-btn" title="إضافة صورة">
                        <i class="fas fa-image"></i>
                    </button>
                    <button id="send-button">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="controls">
        <button class="control-btn" id="fullscreen-toggle" title="ملء الشاشة">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
            </svg>
        </button>
    </div>

    <!-- Welcome Modal -->
    <div class="welcome-modal" id="welcome-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>مرحباً بك في HSG AI!</h2>
            </div>
            <div class="modal-body">
                <p>أنا مساعدك الذكي الشخصي من HSG . يمكنني مساعدتك في:</p>
                <ul>
                    <li>الإجابة على الأسئلة</li>
                    <li>حل المشكلات البرمجية</li>
                    <li>تقديم النصائح والإرشادات</li>
                    <li>المساعدة في الكتابة والترجمة</li>
                </ul>
                <p>يمكنك تغيير نموذج الذكاء الاصطناعي من الإعدادات حسب احتياجاتك.</p>
            </div>
            <div class="modal-footer">
                <button id="start-chat" class="modal-btn">ابدأ المحادثة</button>
            </div>
        </div>
    </div>

    <!-- Emoji Picker -->
    <div class="emoji-picker" id="emoji-picker">
        <div class="emoji-categories">
            <button class="emoji-category active" data-category="all">الكل</button>
            <button class="emoji-category" data-category="smileys">وجوه</button>
            <button class="emoji-category" data-category="animals">حيوانات</button>
            <button class="emoji-category" data-category="food">طعام</button>
            <button class="emoji-category" data-category="travel">سفر</button>
            <button class="emoji-category" data-category="objects">أشياء</button>
            <button class="emoji-category" data-category="symbols">رموز</button>
        </div>
        <div class="emoji-grid" id="emoji-grid"></div>
    </div>

    <!-- Settings Panel -->
    <div class="settings-panel" id="settings-panel">
        <div class="settings-header">
            <div class="settings-title">الإعدادات المتقدمة</div>
            <button class="close-settings" id="close-settings" title="إغلاق الإعدادات">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="settings-section">
            <h4><i class="fas fa-paint-brush"></i> المظهر</h4>
            <div class="settings-option">
                <label for="theme-switch">الوضع الليلي</label>
                <label class="switch">
                    <input type="checkbox" id="theme-switch" checked>
                    <span class="slider"></span>
                    <span class="switch-labels">
                        <span>ON</span>
                        <span>OFF</span>
                    </span>
                </label>
            </div>
            <div class="settings-option">
                <label for="font-size">حجم الخط</label>
                <select id="font-size">
                    <option value="small">صغير</option>
                    <option value="medium" selected>متوسط</option>
                    <option value="large">كبير</option>
                </select>
            </div>
        </div>
          <div class="settings-section">
            <h4><i class="fas fa-robot"></i> نماذج الذكاء الاصطناعي</h4>
            <div class="settings-option">
                <label>نموذج المساعد</label>
                <p>HSG AI 1.5 Flash</p>
            </div>
            <div class="settings-info">
                <p class="user-info">تم تطوير هذا المساعد بواسطة شركة HSG المتخصصة في تصميم وتطوير المواقع الإلكترونية باحترافية عالية.</p>
            </div>
        </div>
        
        <div class="settings-section">
            <h4><i class="fas fa-bell"></i> الإشعارات والخصوصية</h4>
            <div class="settings-option">
                <label for="notifications">إشعارات الرسائل</label>
                <label class="switch">
                    <input type="checkbox" id="notifications" checked>
                    <span class="slider"></span>
                    <span class="switch-labels">
                        <span>ON</span>
                        <span>OFF</span>
                    </span>
                </label>
            </div>
            <div class="settings-option">
                <label for="save-chats">حفظ المحادثات</label>
                <label class="switch">
                    <input type="checkbox" id="save-chats" checked>
                    <span class="slider"></span>
                    <span class="switch-labels">
                        <span>ON</span>
                        <span>OFF</span>
                    </span>
                </label>
            </div>
        </div>

        <div class="settings-section">
            <h4><i class="fas fa-user-cog"></i> إعدادات الحساب</h4>
            <div class="settings-info">
                <p class="user-info">مرحباً، <span id="current-username"></span></p>
            </div>
            <button class="settings-danger-btn" id="settings-logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                تسجيل الخروج
            </button>
        </div>

        <div class="settings-section">
            <h4><i class="fas fa-headset"></i> الدعم الفني</h4>
            <div class="settings-info">
                <p class="user-info">للمساعدة والدعم الفني، يمكنك التواصل معنا عبر واتساب</p>
                <a href="https://wa.me/972592311460?text=مرحباً" target="_blank" class="website-link-btn" style="background: #25D366;">
                    <i class="fab fa-whatsapp"></i>
                    تواصل مع الدعم الفني
                </a>
            </div>
        </div>
        
        <button class="action-btn" id="reset-settings" style="width: 100%; margin-top: 15px; background: rgba(255, 0, 0, 0.1); border: 1px solid rgba(255, 0, 0, 0.2);">
            <i class="fas fa-undo"></i> إعادة تعيين الإعدادات
        </button>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notification-text">تمت العملية بنجاح</span>
    </div>

    <!-- Code Preview Modal -->
    <div class="code-preview-modal" id="code-preview-modal">
        <div class="code-preview-content">
            <div class="code-preview-header">
                <div class="code-preview-title">معاينة الكود</div>
                <button class="close-preview" id="close-preview">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <iframe class="code-preview-frame" id="code-preview-frame"></iframe>
        </div>
    </div>

    <script>
        // Initialize space background with stars, meteors, planets, moon and satellites
        function createSpaceBackground() {
            const spaceBg = document.getElementById('space-bg');
            const numStars = 200;
            const numMeteors = 5;

            // Create stars
            for (let i = 0; i < numStars; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.setProperty('--duration', Math.random() * 5 + 3 + 's');
                star.style.opacity = Math.random() * 0.8 + 0.2;
                spaceBg.appendChild(star);
            }

            // Create meteors
            for (let i = 0; i < numMeteors; i++) {
                const meteor = document.createElement('div');
                meteor.className = 'meteor';
                meteor.style.top = Math.random() * 100 + '%';
                meteor.style.left = Math.random() * 100 + '%';
                meteor.style.setProperty('--duration', Math.random() * 10 + 5 + 's');
                meteor.style.animationDelay = Math.random() * 20 + 's';
                spaceBg.appendChild(meteor);
            }
        }

        // Initialize space background
        createSpaceBackground();

        // OpenRouter configuration
        const API_KEY = 'AIzaSyAbJgoTL65jZPOUJRetiYdgMod3MAdIBCk';
        const API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent';
        // DOM elements
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const imageInput = document.getElementById('image-input');
        const imageButton = document.getElementById('image-button');
        const typingIndicator = document.getElementById('typing-indicator');
        const themeToggle = document.getElementById('theme-toggle');
        const fullscreenToggle = document.getElementById('fullscreen-toggle');
        const chatContainer = document.querySelector('.chat-container');
        const settingsBtn = document.getElementById('settings-btn');
        
        let selectedImage = null;
        const settingsPanel = document.getElementById('settings-panel');
        const closeSettings = document.getElementById('close-settings');
        const clearChatBtn = document.getElementById('clear-chat');
        const helpBtn = document.getElementById('help-btn');
        const welcomeModal = document.getElementById('welcome-modal');
        const startChatBtn = document.getElementById('start-chat');
        const emojiBtn = document.getElementById('emoji-btn');
        const emojiPicker = document.getElementById('emoji-picker');
        const emojiGrid = document.getElementById('emoji-grid');
        const notification = document.getElementById('notification');
        const fontSizeSelect = document.getElementById('font-size');
        const themeSwitch = document.getElementById('theme-switch');

        // Chat history
        let chatHistory = [];
        let isFirstVisit = true;        // Load settings from localStorage
        function loadSettings() {
            const savedTheme = localStorage.getItem('hsgai_theme');
            const savedFontSize = localStorage.getItem('hsgai_fontSize');
            const savedNotifications = localStorage.getItem('hsgai_notifications');
            const savedSaveChats = localStorage.getItem('hsgai_saveChats');

            if (savedTheme) {
                document.documentElement.setAttribute('data-theme', savedTheme);
                themeSwitch.checked = savedTheme === 'dark';
            }
            
            if (savedFontSize) {
                document.documentElement.setAttribute('data-font-size', savedFontSize);
                fontSizeSelect.value = savedFontSize;
            }
            
            if (savedNotifications) {
                document.getElementById('notifications').checked = savedNotifications === 'true';
            }
            
            if (savedSaveChats) {
                document.getElementById('save-chats').checked = savedSaveChats === 'true';
            }
        }// Save settings to localStorage
        function saveSettings() {
            localStorage.setItem('hsgai_theme', document.documentElement.getAttribute('data-theme') || 'dark');
            localStorage.setItem('hsgai_fontSize', fontSizeSelect.value);
            localStorage.setItem('hsgai_notifications', document.getElementById('notifications').checked);
            localStorage.setItem('hsgai_saveChats', document.getElementById('save-chats').checked);
        }        // Reset settings to default
        function resetSettings() {
            if (confirm('هل أنت متأكد أنك تريد إعادة تعيين جميع الإعدادات إلى القيم الافتراضية؟')) {
                localStorage.clear();
                document.documentElement.setAttribute('data-theme', 'dark');
                document.documentElement.setAttribute('data-font-size', 'medium');
                themeSwitch.checked = true;
                fontSizeSelect.value = 'medium';
                document.getElementById('notifications').checked = true;
                document.getElementById('save-chats').checked = true;
                saveSettings();
                showNotification('تم إعادة تعيين الإعدادات بنجاح', 'success');
            }
        }

        // Check if it's first visit
        if (sessionStorage.getItem('hsgai_welcome_shown') === null) {
            welcomeModal.classList.add('show');
            sessionStorage.setItem('hsgai_welcome_shown', 'true');
            isFirstVisit = true;
        }

        // Load settings
        loadSettings();

        // Show welcome modal when help button is clicked
        helpBtn.addEventListener('click', () => {
            welcomeModal.classList.add('show');
        });

        // Start chat button
        startChatBtn.addEventListener('click', () => {
            welcomeModal.classList.remove('show');
            // Reset the welcome shown flag when closing the modal
            sessionStorage.removeItem('hsgai_welcome_shown');
        });

        // Auto-resize textarea
        userInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });

        // Add message to chat
        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'} new`;
            
            if (isUser) {
                messageDiv.textContent = content;
                
                // Add message time with status
                const timeDiv = document.createElement('div');
                timeDiv.className = 'message-time';
                timeDiv.innerHTML = `
                    <i class="far fa-clock clock-icon"></i>
                    <span>${getCurrentTime()}</span>
                    <i class="fas fa-check status-icon sent-icon"></i>
                `;
                messageDiv.appendChild(timeDiv);
                
                // Add to chat history
                chatHistory.push({ role: 'user', content: content });

                // Update status after a delay
                setTimeout(() => {
                    timeDiv.innerHTML = `
                        <i class="far fa-clock clock-icon"></i>
                        <span>${getCurrentTime()}</span>
                        <i class="fas fa-check-double status-icon delivered-icon"></i>
                    `;
                }, 1000);
            } else {
                // Process bot response for code blocks
                processBotResponse(content, messageDiv);
                
                // Add message time with read status
                const timeDiv = document.createElement('div');
                timeDiv.className = 'message-time';
                timeDiv.innerHTML = `
                    <i class="far fa-clock clock-icon"></i>
                    <span>${getCurrentTime()}</span>
                    <i class="fas fa-check-double status-icon read-icon"></i>
                `;
                messageDiv.appendChild(timeDiv);
                
                // Add action buttons
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'message-actions';
                actionsDiv.innerHTML = `
                    <button class="action-btn copy-btn" title="نسخ الرسالة">
                        <i class="far fa-copy"></i>
                    </button>
                    <button class="action-btn like-btn" title="الإعجاب بالرد">
                        <i class="far fa-thumbs-up"></i>
                    </button>
                    <button class="action-btn dislike-btn" title="عدم الإعجاب بالرد">
                        <i class="far fa-thumbs-down"></i>
                    </button>
                `;
                messageDiv.appendChild(actionsDiv);
                
                // Add to chat history
                chatHistory.push({ role: 'assistant', content: content });
                
                // Add event listeners to action buttons
                messageDiv.querySelector('.copy-btn').addEventListener('click', () => {
                    navigator.clipboard.writeText(content).then(() => {
                        showNotification('تم نسخ الرسالة بنجاح', 'success');
                    });
                });
                
                messageDiv.querySelector('.like-btn').addEventListener('click', (e) => {
                    e.target.classList.replace('far', 'fas');
                    e.target.style.color = '#00d1b2';
                    showNotification('شكراً لك على التقييم الإيجابي!', 'success');
                });
                
                messageDiv.querySelector('.dislike-btn').addEventListener('click', (e) => {
                    e.target.classList.replace('far', 'fas');
                    e.target.style.color = '#ff3860';
                    showNotification('نأسف أن الرد لم يعجبك. سنحسن من أدائنا.', 'error');
                });
            }
            
            chatMessages.appendChild(messageDiv);
            
            // Scroll to the new message with smooth animation
            messageDiv.scrollIntoView({ behavior: 'smooth', block: 'end' });
            
            return messageDiv;
        }

        // Get current time in HH:MM format
        function getCurrentTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            return `${hours}:${minutes}`;
        }

        // Process bot response to detect and format code blocks and markdown
        function processBotResponse(content, container) {
            // First, escape any HTML in the content
            // Split content into text and code blocks
            const parts = content.split(/(```[\s\S]*?```)/g);
            
            parts.forEach(part => {
                if (part.startsWith('```') && part.endsWith('```')) {
                    // This is a code block
                    const codeMatch = part.match(/```(\w*)\n([\s\S]*?)\n```/);
                    if (codeMatch) {
                        const language = codeMatch[1] || 'text';
                        const codeContent = codeMatch[2].trim(); // Trim the code content
                        
                        const codeBlock = document.createElement('div');
                        codeBlock.className = 'code-block';
                        
                        const codeHeader = document.createElement('div');
                        codeHeader.className = 'code-header';
                        
                        const languageSpan = document.createElement('span');
                        languageSpan.className = 'code-language';
                        languageSpan.textContent = language;
                        
                        const copyButton = document.createElement('button');
                        copyButton.className = 'copy-btn';
                        copyButton.innerHTML = '<i class="far fa-copy"></i> نسخ الكود';
                        copyButton.addEventListener('click', () => {
                            // Get only the code content without any extra text
                            const codeToCopy = codeContent;
                            navigator.clipboard.writeText(codeToCopy).then(() => {
                                copyButton.classList.add('copied');
                                copyButton.innerHTML = '<i class="fas fa-check"></i> تم النسخ!';
                                setTimeout(() => {
                                    copyButton.classList.remove('copied');
                                    copyButton.innerHTML = '<i class="far fa-copy"></i> نسخ الكود';
                                }, 2000);
                                showNotification('تم نسخ الكود بنجاح', 'success');
                            }).catch(err => {
                                console.error('Failed to copy code:', err);
                                showNotification('حدث خطأ أثناء نسخ الكود', 'error');
                            });
                        });
                        
                        codeHeader.appendChild(languageSpan);
                        codeHeader.appendChild(copyButton);
                        codeBlock.appendChild(codeHeader);
                        
                        const codePre = document.createElement('pre');
                        codePre.className = 'code-content';
                        codePre.textContent = codeContent;
                        codeBlock.appendChild(codePre);
                        
                        container.appendChild(codeBlock);
                    }
                } else if (part.trim()) {
                    // This is regular text
                    const textDiv = document.createElement('div');
                    textDiv.className = 'message-text';
                    
                    // Process markdown in text
                    let processedText = part
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // Bold
                        .replace(/\*(.*?)\*/g, '<em>$1</em>') // Italic
                        .replace(/`(.*?)`/g, '<code>$1</code>') // Inline code
                        .replace(/~~(.*?)~~/g, '<del>$1</del>') // Strikethrough
                        .replace(/==(.*?)==/g, '<mark>$1</mark>') // Highlight
                        .replace(/^# (.*$)/gm, '<h1>$1</h1>') // H1
                        .replace(/^## (.*$)/gm, '<h2>$1</h2>') // H2
                        .replace(/^### (.*$)/gm, '<h3>$1</h3>') // H3
                        .replace(/^#### (.*$)/gm, '<h4>$1</h4>') // H4
                        .replace(/^##### (.*$)/gm, '<h5>$1</h5>') // H5
                        .replace(/^###### (.*$)/gm, '<h6>$1</h6>'); // H6
                    
                    textDiv.innerHTML = processedText;
                    container.appendChild(textDiv);
                }
            });
        }

        // Code Preview Modal functionality
        const codePreviewModal = document.getElementById('code-preview-modal');
        const closePreview = document.getElementById('close-preview');

        // Close modal when clicking the close button
        closePreview.addEventListener('click', () => {
            codePreviewModal.classList.remove('show');
        });

        // Close modal when clicking outside
        codePreviewModal.addEventListener('click', (e) => {
            if (e.target === codePreviewModal) {
                codePreviewModal.classList.remove('show');
            }
        });

        // Close modal when pressing Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && codePreviewModal.classList.contains('show')) {
                codePreviewModal.classList.remove('show');
            }
        });

        // Send message to AI
        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message && !selectedImage) return;

            // Add user message to chat
            const userMessageDiv = addMessage(message, true);
            userInput.value = '';
            userInput.style.height = 'auto';

            // Scroll to the user message immediately
            userMessageDiv.scrollIntoView({ behavior: 'smooth', block: 'end' });

            // Show typing indicator and disable input
            typingIndicator.style.display = 'flex';
            setInputState(true);

            try {
                const parts = [];
                
                if (message) {
                    let enhancedMessage = message;
                    
                    // Handle name-related questions
                    if (message.toLowerCase().includes('اسمك') || 
                        message.toLowerCase().includes('ما اسمك') || 
                        message.toLowerCase().includes('من انت') ||
                        message.toLowerCase().includes('تعرف نفسك') ||
                        message.toLowerCase().includes('عرف نفسك')) {
                        enhancedMessage = `مرحباً بك في HSG AI! أنا مساعدك الذكي المتطور من شركة HSG.`;
                    } 
                    // Handle company-related questions
                    else if (message.toLowerCase().includes('صنعك') || 
                             message.toLowerCase().includes('عملتك') || 
                             message.toLowerCase().includes('من اي شركة') ||
                             message.toLowerCase().includes('شركة') ||
                             message.toLowerCase().includes('hsg')) {
                        enhancedMessage = `تم تطويري بواسطة شركة HSG المتخصصة في تصميم وتطوير المواقع الإلكترونية. نحن نقدم خدمات احترافية في مجال التصميم والبرمجة، مع التركيز على تقديم تجربة مستخدم مميزة وتصاميم عصرية.

<a href="https://hsg-ashy.vercel.app/" target="_blank" class="website-link-btn">
    <i class="fas fa-external-link-alt"></i>
    زيارة موقع HSG
</a>`;
                    }
                    
                    parts.push({ text: enhancedMessage });
                }
                
                if (selectedImage) {
                    parts.push({
                        inlineData: {
                            mimeType: "image/jpeg",
                            data: selectedImage
                        }
                    });
                }
                
                const response = await fetch(`${API_URL}?key=${API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: parts
                        }]
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }

                const data = await response.json();
                
                if (!data.candidates || !data.candidates[0]?.content?.parts?.[0]?.text) {
                    throw new Error('Invalid response format from API');
                }

                const botResponse = data.candidates[0].content.parts[0].text;
                
                // Hide typing indicator
                typingIndicator.style.display = 'none';
                
                // Add and format the bot response
                const botMessageDiv = addMessage(botResponse, false);
                
                // Scroll to the bot response
                botMessageDiv.scrollIntoView({ behavior: 'smooth', block: 'end' });
                
                // Reset image selection
                selectedImage = null;
                imageButton.innerHTML = '<i class="fas fa-image"></i>';
                imageButton.style.color = '';
                
                // Show notification for new message
                if (document.getElementById('notifications').checked) {
                    showNotification('تم استلام رد جديد من المساعد', 'success');
                }
            } catch (error) {
                console.error('Error:', error);
                typingIndicator.style.display = 'none';
                
                let errorMessage = 'حدث خطأ أثناء معالجة طلبك. يرجى المحاولة مرة أخرى لاحقاً.';
                if (error.message.includes('Failed to fetch')) {
                    errorMessage = 'تعذر الاتصال بالخادم. يرجى التحقق من اتصالك بالإنترنت والمحاولة مرة أخرى.';
                } else if (error.message.includes('API key')) {
                    errorMessage = 'مفتاح API غير صالح أو منتهي الصلاحية. يرجى التحقق من المفتاح والمحاولة مرة أخرى.';
                }
                
                const errorMessageDiv = addMessage(errorMessage, false);
                errorMessageDiv.scrollIntoView({ behavior: 'smooth', block: 'end' });
                showNotification(errorMessage, 'error');
            } finally {
                // Re-enable input
                setInputState(false);
            }
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notification-text');
            
            notification.className = 'notification';
            notification.classList.add(type);
            notification.classList.add('show');
            notificationText.textContent = message;
            
            // Set icon based on type
            const icon = notification.querySelector('i');
            if (type === 'success') {
                icon.className = 'fas fa-check-circle';
            } else if (type === 'error') {
                icon.className = 'fas fa-exclamation-circle';
            } else if (type === 'warning') {
                icon.className = 'fas fa-exclamation-triangle';
            }
            
            // Hide after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Event listeners
        sendButton.addEventListener('click', sendMessage);
        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Disable/enable input during processing
        function setInputState(disabled) {
            userInput.disabled = disabled;
            sendButton.disabled = disabled;
            sendButton.classList.toggle('loading', disabled);
        }

        // Theme Toggle
        themeSwitch.addEventListener('change', () => {
            const isDarkTheme = themeSwitch.checked;
            document.documentElement.setAttribute('data-theme', isDarkTheme ? 'dark' : 'light');
            saveSettings();
            showNotification(`تم تفعيل الوضع ${isDarkTheme ? 'الليلي' : 'النهاري'}`, 'success');
        });

        // Font size change
        fontSizeSelect.addEventListener('change', () => {
            document.documentElement.setAttribute('data-font-size', fontSizeSelect.value);
            saveSettings();
            showNotification(`تم تغيير حجم الخط إلى ${fontSizeSelect.options[fontSizeSelect.selectedIndex].text}`, 'success');
        });

        // Fullscreen Toggle
        fullscreenToggle.addEventListener('click', () => {
            chatContainer.classList.toggle('fullscreen');
            if (chatContainer.classList.contains('fullscreen')) {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeSwitch.checked = true;
                saveSettings();
                showNotification('تم تفعيل وضع ملء الشاشة', 'success');
            }
            createRipple(fullscreenToggle);
        });

        // Settings Panel
        settingsBtn.addEventListener('click', () => {
            settingsPanel.classList.add('open');
            createRipple(settingsBtn);
        });

        closeSettings.addEventListener('click', () => {
            settingsPanel.classList.remove('open');
        });

        // إضافة مستمع للنقر خارج مربع الإعدادات
        document.addEventListener('click', (e) => {
            // التحقق ما إذا كان النقر خارج مربع الإعدادات وأن مربع الإعدادات مفتوح
            if (!settingsPanel.contains(e.target) && 
                !settingsBtn.contains(e.target) && 
                settingsPanel.classList.contains('open')) {
                settingsPanel.classList.remove('open');
            }
        });

        // منع إغلاق مربع الإعدادات عند النقر داخله
        settingsPanel.addEventListener('click', (e) => {
            e.stopPropagation();
        });        // Save settings when changed
        document.querySelectorAll('#notifications, #save-chats').forEach(el => {
            el.addEventListener('change', saveSettings);
        });

        // Reset settings
        document.getElementById('reset-settings').addEventListener('click', resetSettings);

        // Clear Chat
        clearChatBtn.addEventListener('click', () => {
            if (chatMessages.children.length > 1 || chatHistory.length > 0) {
                if (confirm('هل أنت متأكد أنك تريد مسح كل المحادثة؟')) {
                    chatMessages.innerHTML = `
                        <div class="message bot-message new">
                            مرحباً بك في HSG AI! أنا مساعدك الذكي المتطور. كيف يمكنني مساعدتك اليوم؟ 😊
                            <div class="message-time">
                                <i class="far fa-clock"></i> الآن
                            </div>
                        </div>
                    `;
                    chatHistory = [];
                    showNotification('تم مسح المحادثة بنجاح', 'success');
                }
            } else {
                showNotification('لا توجد محادثة لمسحها', 'warning');
            }
            createRipple(clearChatBtn);
        });

        // Image handling
        imageButton.addEventListener('click', () => {
            imageInput.click();
        });

        imageInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file) {
                if (file.size > 4 * 1024 * 1024) { // 4MB limit
                    showNotification('حجم الصورة يجب أن لا يتجاوز 4 ميجابايت', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    selectedImage = e.target.result.split(',')[1];
                    imageButton.innerHTML = '<i class="fas fa-check"></i>';
                    imageButton.style.color = 'var(--success)';
                    showNotification('تم تحميل الصورة بنجاح', 'success');
                };
                reader.readAsDataURL(file);
            }
        });

        // Create ripple effect
        function createRipple(element) {
            const ripple = document.createElement('div');
            ripple.className = 'ripple';
            const rect = element.getBoundingClientRect();
            ripple.style.left = (element.offsetWidth / 2) + 'px';
            ripple.style.top = (element.offsetHeight / 2) + 'px';
            element.appendChild(ripple);
            setTimeout(() => ripple.remove(), 600);
        }

        // Add ripple effect to all buttons
        document.querySelectorAll('button').forEach(button => {
            button.addEventListener('click', function(e) {
                // Only add ripple if the button doesn't already have specific handling
                if (!this.id || !['send-button', 'theme-toggle', 'fullscreen-toggle'].includes(this.id)) {
                    createRipple(this);
                }
            });
        });

        // Emoji Picker
        emojiBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            emojiPicker.classList.toggle('show');
        });

        // Close emoji picker when clicking outside
        document.addEventListener('click', (e) => {
            if (!emojiPicker.contains(e.target) && e.target !== emojiBtn) {
                emojiPicker.classList.remove('show');
            }
        });

        // Load emojis
        const emojis = {
            'smileys': ['😀', '😃', '😄', '😁', '😆', '😅', '😂', '🤣', '😊', '😇', '🙂', '🙃', '😉', '😌', '😍', '🥰', '😘', '😗', '😙', '😚', '😋', '😛', '😝', '😜', '🤪', '🤨', '🧐', '🤓', '😎', '🥸', '🤩', '🥳', '😏', '😒', '😞', '😔', '😟', '😕', '🙁', '☹️', '😣', '😖', '😫', '😩', '🥺', '😢', '😭', '😤', '😠', '😡', '🤬', '🤯', '😳', '🥵', '🥶', '😱', '😨', '😰', '😥', '😓', '🤗', '🤔', '🤭', '🤫', '🤥', '😶', '😐', '😑', '😬', '🙄', '😯', '😦', '😧', '😮', '😲', '🥱', '😴', '🤤', '😪', '😵', '🤐', '🥴', '🤢', '🤮', '🤧', '😷', '🤒', '🤕', '🤑', '🤠', '😈', '👿', '👹', '👺', '🤡', '💩', '👻', '💀', '☠️', '👽', '👾', '🤖', '🎃', '😺', '😸', '😹', '😻', '😼', '😽', '🙀', '😿', '😾'],
            'animals': ['🐶', '🐱', '🐭', '🐹', '🐰', '🦊', '🐻', '🐼', '🐨', '🐯', '🦁', '🐮', '🐷', '🐽', '🐸', '🐵', '🙈', '🙉', '🙊', '🐒', '🐔', '🐧', '🐦', '🐤', '🐣', '🐥', '🦆', '🦅', '🦉', '🦇', '🐺', '🐗', '🐴', '🦄', '🐝', '🐛', '🦋', '🐌', '🐞', '🐜', '🦟', '🦗', '🕷', '🦂', '🐢', '🐍', '🦎', '🦖', '🦕', '🐙', '🦑', '🦐', '🦞', '🦀', '🐡', '🐠', '🐟', '🐬', '🐳', '🐋', '🦈', '🐊', '🐅', '🐆', '🦓', '🦍', '🦧', '🐘', '🦛', '🦏', '🐪', '🐫', '🦒', '🦘', '🐃', '🐂', '🐄', '🐎', '🐖', '🐏', '🐑', '🦙', '🐐', '🦌', '🐕', '🐩', '🦮', '🐕‍🦺', '🐈', '🐓', '🦃', '🦚', '🦜', '🦢', '🦩', '🐇', '🦝', '🦨', '🦦', '🦥', '🐁', '🐀', '🦔'],
            'food': ['🍏', '🍎', '🍐', '🍊', '🍋', '🍌', '🍉', '🍇', '🍓', '🫐', '🍈', '🍒', '🍑', '🥭', '🍍', '🥥', '🥝', '🍅', '🍆', '🥑', '🥦', '🥬', '🥒', '🌶', '🫑', '🌽', '🥕', '🫒', '🧄', '🧅', '🥔', '🍠', '🥐', '🥯', '🍞', '🥖', '🥨', '🧀', '🥚', '🍳', '🧈', '🥞', '🧇', '🥓', '🥩', '🍗', '🍖', '🦴', '🌭', '🍔', '🍟', '🍕', '🫓', '🥪', '🥙', '🧆', '🌮', '🌯', '🫔', '🥗', '8', '🫕', '🥫', '🍝', '🍜', '🍲', '🍛', '🍣', '🍱', '🥟', '🦪', '🍤', '🍙', '🍚', '🍘', '🍥', '🥠', '🥮', '🍢', '🍡', '🍧', '🍨', '🍦', '🥧', '🧁', '🍰', '🎂', '🍮', '🍭', '🍬', '🍫', '🍿', '🫖', '🍩', '🍪', '🌰', '🥜', '🍯', '🥛', '🍼', '🫖', '☕', '🍵', '🧃', '🥤', '🍶', '🍺', '🍻', '🥂', '🍷', '🥃', '🍸', '🍹', '🧉', '🍾', '🧊', '🥄', '🍴', '🍽', '🥣', '🥡', '🥢', '🧂'],
            'travel': ['🌍', '🌎', '🌏', '🌐', '🗺️', '🧭', '🏔️', '⛰️', '🌋', '🗻', '🏕️', '🏖️', '🏜️', '🏝️', '🏞️', '🏟️', '🏛️', '🏗️', '🧱', '🏘️', '🏚️', '🏠', '🏡', '🏢', '🏣', '🏤', '🏥', '🏦', '🏨', '🏩', '🏪', '🏫', '🏬', '🏭', '🏯', '🏰', '💒', '🗼', '🗽', '⛪', '🕌', '🛕', '🕍', '⛩️', '🕋', '⛲', '⛺', '🌁', '🌃', '🏙️', '🌄', '🌅', '🌆', '🌇', '🌉', '♨️', '🎠', '🎡', '🎢', '💈', '🎪', '🚂', '🚃', '🚄', '🚅', '🚆', '🚇', '🚈', '🚉', '🚊', '🚝', '🚞', '🚋', '🚌', '🚍', '🚎', '🚐', '🚑', '🚒', '🚓', '🚔', '🚕', '🚖', '🚗', '🚘', '🚙', '🚚', '🚛', '🚜', '🏎️', '🏍️', '🛵', '🦽', '🦼', '🛺', '🚲', '🛴', '🛹', '🚏', '🛣️', '🛤️', '🛢️', '⛽', '🚨', '🚥', '🚦', '🛑', '🚧', '⚓', '⛵', '🛶', '🚤', '🛳️', '⛴️', '🛥️', '🚢', '✈️', '🛩️', '🛫', '🛬', '🪂', '💺', '🚁', '🚟', '🚠', '🚡', '🛰️', '🚀', '🛸', '🛎️', '🧳', '⌛', '⏳', '⌚', '⏰', '⏱️', '⏲️', '🕰️', '🌡️', '⛱️', '🧨', '🎈', '🎉', '🎊', '🎎', '🎏', '🎐', '🎀', '🎁', '🎫', '🏆', '🏅', '🎖️', '🥇', '🥈', '🥉', '⚽', '⚾', '🥎', '🏀', '🏐', '🏈', '🏉', '🎾', '🥏', '🎳', '🏏', '🏑', '🏒', '🥍', '🏓', '🏸', '🥊', '🥋', '🥅', '⛳', '🪁', '🏹', '🎣', '🤿', '🥌', '🎯', '🪀', '🪃', '🎱', '🔮', '🧿', '🎮', '🕹️', '🎰', '🎲', '🧩', '🧸', '♠️', '♥️', '♦️', '♣️', '♟️', '🃏', '🀄', '🎴', '🎭', '🖼️', '🎨', '🧵', '🧶', '🪡', '🪢'],
            'objects': ['👓', '🕶️', '🥽', '🥼', '🦺', '👔', '👕', '👖', '🧣', '🧤', '🧥', '🧦', '👗', '👘', '🥻', '🩱', '🩲', '🩳', '👙', '👚', '👛', '👜', '👝', '🛍️', '🎒', '👞', '👟', '🥾', '🥿', '👠', '👡', '🩰', '👢', '👑', '👒', '🎩', '🎓', '🧢', '🪖', '⛑️', '💄', '💍', '💼', '📱', '📲', '⌨️', '🖥️', '🖨️', '🖱️', '🖲️', '💽', '💾', '💿', '📀', '🧮', '📱', '📲', '☎️', '📞', '📟', '📠', '🔋', '🔌', '💻', '🖥️', '🖨️', '⌨️', '🖱️', '🖲️', '💽', '💾', '💿', '📀', '🧮', '🎥', '🎞️', '📽️', '🎬', '📺', '📷', '📸', '📹', '📼', '🔍', '🔎', '🕯️', '💡', '🔦', '🏮', '🪔', '📔', '📕', '📖', '📗', '📘', '📙', '📚', '📓', '📒', '📃', '📜', '📄', '📰', '🗞️', '📑', '🔖', '🏷️', '💰', '🪙', '💴', '💵', '💶', '💷', '💸', '💳', '🧾', '💹', '✉️', '📧', '📨', '📩', '📤', '📥', '📦', '📫', '📪', '📬', '📭', '📮', '🗳️', '✏️', '✒️', '🖋️', '🖊️', '🖌️', '🖍️', '📝', '💼', '📁', '📂', '🗂️', '📅', '📆', '🗒️', '🗓️', '📇', '📈', '📉', '📊', '📋', '📌', '📍', '📎', '🖇️', '📏', '📐', '✂️', '🗃️', '🗄️', '🗑️', '🔒', '🔓', '🔏', '🔐', '🔑', '🗝️', '🔨', '🪓', '⛏️', '⚒️', '🛠️', '🗡️', '⚔️', '🔫', '🏹', '🛡️', '🔧', '🔩', '⚙️', '🗜️', '⚖️', '🦯', '🔗', '⛓️', '🧰', '🧲', '🪜', '⚗️', '🧪', '🧫', '🧬', '🔬', '🔭', '📡', '💉', '🩸', '💊', '🩹', '🩺', '🚪', '🛏️', '🛋️', '🪑', '🚽', '🪠', '🚿', '🛁', '🪤', '🪒', '🧴', '🧷', '🧹', '🧺', '🧻', '🪣', '🧼', '🪥', '🧽', '🧯', '🛒', '🚬', '⚰️', '🪦', '⚱️', '🧿', '🪄', '🧙', '🧚', '🧛', '🧜', '🧝', '🧞', '🧟', '🧌'],
            'symbols': ['💘', '💝', '💖', '💗', '💓', '💞', '💕', '💟', '❣️', '💔', '❤️', '🧡', '💛', '💚', '💙', '💜', '🤎', '🖤', '🤍', '💯', '💢', '💥', '💫', '💦', '💨', '🕳️', '💣', '💬', '👁️‍🗨️', '🗨️', '🗯️', '💭', '💤', '👋', '🤚', '🖐️', '✋', '🖖', '👌', '🤏', '✌️', '🤞', '🤟', '🤘', '🤙', '👈', '👉', '👆', '🖕', '👇', '☝️', '👍', '👎', '✊', '👊', '🤛', '🤜', '👏', '🙌', '👐', '🤲', '🤝', '🙏', '✍️', '💅', '🤳', '💪', '🦾', '🦿', '🦵', '🦶', '👂', '🦻', '👃', '🧠', '🫀', '🫁', '🦷', '🦴', '👀', '👁️', '👅', '👄', '🫦', '👶', '🧒', '👦', '👧', '🧑', '👨', '👩', '🧓', '👴', '👵', '🙍', '🙎', '🙅', '🙆', '💁', '🙋', '🧏', '🙇', '🤦', '🤷', '👮', '🕵️', '💂', '🥷', '👷', '🤴', '👸', '👳', '👲', '🧕', '🤵', '👰', '🤰', '🫃', '🫄', '🤱', '👼', '🎅', '🤶', '🦸', '🦹', '🧙', '🧚', '🧛', '🧜', '🧝', '🧞', '🧟', '🧌', '💆', '💇', '🚶', '🧍', '🧎', '🏃', '💃', '🕺', '🕴️', '👯', '🧖', '🧗', '🤺', '🏇', '⛷️', '🏂', '🏌️', '🏄', '🚣', '🏊', '⛹️', '🏋️', '🚴', '🚵', '🤸', '🤼', '🤽', '🤾', '🤹', '🧘', '🛀', '🛌', '🧑‍🤝‍🧑', '👭', '👫', '👬', '💏', '💑', '👪', '🗣️', '👤', '👥', '🫂', '👣', '🦰', '🦱', '🦳', '🦲']
        };

        // Populate emoji grid
        function populateEmojiGrid(category = 'all') {
            emojiGrid.innerHTML = '';
            let emojiList = [];
            
            if (category === 'all') {
                for (const cat in emojis) {
                    emojiList = emojiList.concat(emojis[cat]);
                }
            } else {
                emojiList = emojis[category] || [];
            }
            
            emojiList.forEach(emoji => {
                const emojiItem = document.createElement('div');
                emojiItem.className = 'emoji-item';
                emojiItem.textContent = emoji;
                emojiItem.addEventListener('click', () => {
                    userInput.value += emoji;
                    userInput.focus();
                    emojiPicker.classList.remove('show');
                });
                emojiGrid.appendChild(emojiItem);
            });
        }

        // Initialize emoji picker
        populateEmojiGrid();

        // Emoji category switching
        document.querySelectorAll('.emoji-category').forEach(cat => {
            cat.addEventListener('click', () => {
                document.querySelector('.emoji-category.active').classList.remove('active');
                cat.classList.add('active');
                populateEmojiGrid(cat.dataset.category);
            });
        });

        // Initialize with a greeting if chat is empty
        if (chatMessages.children.length === 0) {
            addMessage(`مرحباً بك في HSG AI! أنا مساعدك الذكي المتطور من شركة HSG.

<a href="https://hsg-ashy.vercel.app/" target="_blank" class="website-link-btn">
    <i class="fas fa-external-link-alt"></i>
    زيارة موقع HSG
</a>`, false);
        }

        // عرض اسم المستخدم في الإعدادات
        document.getElementById('current-username').textContent = sessionStorage.getItem('currentUser') || 'زائر';

        // إضافة وظيفة تسجيل الخروج
        document.getElementById('settings-logout-btn').addEventListener('click', () => {
            if (confirm('هل أنت متأكد أنك تريد تسجيل الخروج؟')) {
                sessionStorage.removeItem('currentUser');
                window.location.href = 'login/l0gin.html';
            }
        });

        // Update settings section
        document.querySelector('.settings-section:nth-child(2) .settings-option p').textContent = 'HSG AI 1.5 Flash';
        document.querySelector('.settings-info .user-info').innerHTML = `
            <p>تم تطوير هذا المساعد بواسطة شركة HSG المتخصصة في تصميم وتطوير المواقع الإلكترونية.</p>
            <p>مدير الشركة: Mohammed ziyad</p>
            <a href="https://hsg-ashy.vercel.app/" target="_blank" class="website-link-btn">
                <i class="fas fa-external-link-alt"></i>
                زيارة موقع HSG
            </a>
        `;
    </script>
</body>
</html>